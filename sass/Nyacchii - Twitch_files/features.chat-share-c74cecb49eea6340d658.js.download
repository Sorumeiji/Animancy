(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{"3WWB":function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"Chat_ShareResub_UseResubToken"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UseChatNotificationTokenInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"useChatNotificationToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isSuccess"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:136}};n.loc.source={body:"mutation Chat_ShareResub_UseResubToken($input: UseChatNotificationTokenInput!) {\nuseChatNotificationToken(input: $input) {\nisSuccess\n}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function a(e,t){for(var n=0;n<e.definitions.length;n++){var i=e.definitions[n];if(i.name&&i.name.value==t)return i}}n.definitions.forEach((function(e){if(e.name){var t=new Set;!function e(t,n){if("FragmentSpread"===t.kind)n.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&n.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach((function(t){e(t,n)})),t.variableDefinitions&&t.variableDefinitions.forEach((function(t){e(t,n)})),t.definitions&&t.definitions.forEach((function(t){e(t,n)}))}(e,t),i[e.name.value]=t}})),e.exports=n,e.exports.Chat_ShareResub_UseResubToken=function(e,t){var n={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var s=i[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var c=o;o=new Set,c.forEach((function(e){r.has(e)||(r.add(e),(i[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var i=a(e,t);i&&n.definitions.push(i)})),n}(n,"Chat_ShareResub_UseResubToken")},EnXQ:function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Chat_ShareResub_ChannelData"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelLogin"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"login"},value:{kind:"Variable",name:{kind:"Name",value:"channelLogin"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resubNotification"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cumulativeTenureMonths"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"months"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"streakTenureMonths"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:184}};n.loc.source={body:"query Chat_ShareResub_ChannelData($channelLogin: String!) {\nuser(login: $channelLogin) {\nid\nself {\nresubNotification {\nid\ncumulativeTenureMonths\nmonths\nstreakTenureMonths\ntoken\n}\n}\n}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function a(e,t){for(var n=0;n<e.definitions.length;n++){var i=e.definitions[n];if(i.name&&i.name.value==t)return i}}n.definitions.forEach((function(e){if(e.name){var t=new Set;!function e(t,n){if("FragmentSpread"===t.kind)n.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&n.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach((function(t){e(t,n)})),t.variableDefinitions&&t.variableDefinitions.forEach((function(t){e(t,n)})),t.definitions&&t.definitions.forEach((function(t){e(t,n)}))}(e,t),i[e.name.value]=t}})),e.exports=n,e.exports.Chat_ShareResub_ChannelData=function(e,t){var n={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var s=i[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var c=o;o=new Set,c.forEach((function(e){r.has(e)||(r.add(e),(i[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var i=a(e,t);i&&n.definitions.push(i)})),n}(n,"Chat_ShareResub_ChannelData")},"L3x+":function(e,t,n){},OFf5:function(e,t,n){"use strict";var i=n("TSYQ"),a=n("q1tI"),s=n("sUnt"),r=n("hnjF"),o=n("7uM4"),c=n("C7sF"),d=(n("tRzL"),function(e){var t=i("rare-emote__face",{"rare-emote__face--animate":!!e.animate}),n=i("rare-emote__neck",{"rare-emote__neck--animate":!!e.animate});return a.createElement(s.a,{overflow:r.i.Hidden,className:"rare-emote"},a.createElement(r.g,{zIndex:r.o.Above,position:r.j.Relative},a.createElement("img",{className:t,src:"https://static-cdn.jtvnw.net/emoticons/v1/"+e.emoteID+"/2.0"})),a.createElement(s.a,{position:r.j.Relative,zIndex:r.o.Default,className:n},a.createElement(o.a,{width:28,height:28,asset:c.a.Neck})))});n.d(t,"a",(function(){return d}))},VDBt:function(e,t,n){},WSq6:function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Chat_ShareBitsBadgeTier_ChannelData"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelLogin"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"login"},value:{kind:"Variable",name:{kind:"Name",value:"channelLogin"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bitsBadge"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tierNotification"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"threshold"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"canShare"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:172}};n.loc.source={body:"query Chat_ShareBitsBadgeTier_ChannelData($channelLogin: String!) {\nuser(login: $channelLogin) {\nid\nself {\nbitsBadge {\nid\ntierNotification {\nid\nthreshold\ncanShare\n}\n}\n}\n}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function a(e,t){for(var n=0;n<e.definitions.length;n++){var i=e.definitions[n];if(i.name&&i.name.value==t)return i}}n.definitions.forEach((function(e){if(e.name){var t=new Set;!function e(t,n){if("FragmentSpread"===t.kind)n.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&n.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach((function(t){e(t,n)})),t.variableDefinitions&&t.variableDefinitions.forEach((function(t){e(t,n)})),t.definitions&&t.definitions.forEach((function(t){e(t,n)}))}(e,t),i[e.name.value]=t}})),e.exports=n,e.exports.Chat_ShareBitsBadgeTier_ChannelData=function(e,t){var n={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var s=i[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var c=o;o=new Set,c.forEach((function(e){r.has(e)||(r.add(e),(i[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var i=a(e,t);i&&n.definitions.push(i)})),n}(n,"Chat_ShareBitsBadgeTier_ChannelData")},"Xa2/":function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateBitsBadgeTierNotification"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UpdateBitsBadgeTierNotificationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateBitsBadgeTierNotification"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:152}};n.loc.source={body:"mutation UpdateBitsBadgeTierNotification($input:UpdateBitsBadgeTierNotificationInput!) {\nupdateBitsBadgeTierNotification(input:$input) {\nuser {\nid\n}\n}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var i={};function a(e,t){for(var n=0;n<e.definitions.length;n++){var i=e.definitions[n];if(i.name&&i.name.value==t)return i}}n.definitions.forEach((function(e){if(e.name){var t=new Set;!function e(t,n){if("FragmentSpread"===t.kind)n.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&n.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach((function(t){e(t,n)})),t.variableDefinitions&&t.variableDefinitions.forEach((function(t){e(t,n)})),t.definitions&&t.definitions.forEach((function(t){e(t,n)}))}(e,t),i[e.name.value]=t}})),e.exports=n,e.exports.UpdateBitsBadgeTierNotification=function(e,t){var n={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var s=i[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var c=o;o=new Set,c.forEach((function(e){r.has(e)||(r.add(e),(i[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var i=a(e,t);i&&n.definitions.push(i)})),n}(n,"UpdateBitsBadgeTierNotification")},Xuad:function(e,t,n){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Chat_ShareBitsBadgeTier_AvailableBadges"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelLogin"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"login"},value:{kind:"Variable",name:{kind:"Name",value:"channelLogin"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"availableBadges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"badge"},directives:[]}]}}]}}]}}]}}],loc:{start:0,end:206}};i.loc.source={body:'#import "twilight/features/badges/models/badge-fragment.gql"\nquery Chat_ShareBitsBadgeTier_AvailableBadges($channelLogin: String!) {\nuser(login: $channelLogin) {\nid\nself {\navailableBadges {\n...badge\n}\n}\n}\n}',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};i.definitions=i.definitions.concat(n("IKE4").definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!a[t]&&(a[t]=!0,!0)})));var s={};function r(e,t){for(var n=0;n<e.definitions.length;n++){var i=e.definitions[n];if(i.name&&i.name.value==t)return i}}i.definitions.forEach((function(e){if(e.name){var t=new Set;!function e(t,n){if("FragmentSpread"===t.kind)n.add(t.name.value);else if("VariableDefinition"===t.kind){var i=t.type;"NamedType"===i.kind&&n.add(i.name.value)}t.selectionSet&&t.selectionSet.selections.forEach((function(t){e(t,n)})),t.variableDefinitions&&t.variableDefinitions.forEach((function(t){e(t,n)})),t.definitions&&t.definitions.forEach((function(t){e(t,n)}))}(e,t),s[e.name.value]=t}})),e.exports=i,e.exports.Chat_ShareBitsBadgeTier_AvailableBadges=function(e,t){var n={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var i=s[t]||new Set,a=new Set,o=new Set;for(i.forEach((function(e){o.add(e)}));o.size>0;){var c=o;o=new Set,c.forEach((function(e){a.has(e)||(a.add(e),(s[e]||new Set).forEach((function(e){o.add(e)})))}))}return a.forEach((function(t){var i=r(e,t);i&&n.definitions.push(i)})),n}(i,"Chat_ShareBitsBadgeTier_AvailableBadges")},miqE:function(e,t,n){"use strict";n.r(t);var i=n("mrSG"),a=n("TSYQ"),s=n("q1tI"),r=n("/7QA"),o=n("cw0r"),c=n("D7An"),d=n("/MKj"),u=n("kRBY"),l=n("w09P"),p=n("fvjX"),h=n("yR8l"),f=n("eDVu"),m=n("0Log"),g=n("geRD"),b=n("/aPz"),v=n("DMoW"),S=n("IZXT"),k=n("RiD7"),N=n("dEDE"),y=n("sUnt"),E=n("hnjF"),B=n("Ws8v"),C=n("X2PJ"),I=n("7d/q"),D=n("C7sF"),T=n("3aAs"),_=(n("VDBt"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={formInputValue:"",sharing:!1},t.hasUnmounted=!1,t.handleShareClick=function(){return Object(i.__awaiter)(t,void 0,void 0,(function(){return Object(i.__generator)(this,(function(e){switch(e.label){case 0:this.setState({sharing:!0}),e.label=1;case 1:return e.trys.push([1,,3,4]),[4,this.props.onShare(this.state.formInputValue)];case 2:return e.sent(),[3,4];case 3:return this.hasUnmounted||this.setState({sharing:!1}),[7];case 4:return[2]}}))}))},t.onInputChange=function(e){t.setState({formInputValue:e.currentTarget.value})},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){this.hasUnmounted=!1},t.prototype.componentWillUnmount=function(){this.hasUnmounted=!0},t.prototype.render=function(){var e=a("share-input",{"share-input--hidden":this.props.hide}),t=this.state.formInputValue.length>255,n=t?"-"+(this.state.formInputValue.length-255):Object(r.d)("Share","ChatResubNotification"),i=Object(r.d)("Close","ChatResubNotification"),o=Object(r.d)("Add a message to the streamer","ChatResubNotification"),c=this.state.sharing?N.c.Loading:N.c.Default;return s.createElement(y.a,{className:e,padding:1,attachTop:!0,attachLeft:!0,attachRight:!0,position:E.j.Absolute},s.createElement(B.a,{className:"share-input__container",position:E.j.Relative,border:!0,background:C.a.Base,padding:1},s.createElement(y.a,{position:E.j.Absolute,attachTop:!0,attachRight:!0},s.createElement(I.a,{ariaLabel:i,onClick:this.props.onClose,type:I.c.Secondary,icon:D.a.Close,"data-a-target":"resub-notification-close-form-btn","data-test-selector":"share-input__close-form-btn"})),s.createElement(y.a,{padding:{top:1,bottom:2}},this.props.children),s.createElement(y.a,{display:E.d.Flex,flexWrap:E.f.NoWrap},s.createElement(y.a,{fullWidth:!0},s.createElement(T.a,{autoFocus:!0,type:T.c.Text,value:this.state.formInputValue,onChange:this.onInputChange,placeholder:o,"data-a-target":"resub-notification-share-message-input","data-test-selector":"share-input__share-message-input"})),s.createElement(N.a,{disabled:t,onClick:this.handleShareClick,"data-a-target":"resub-notification-send-msg-btn","data-test-selector":"share-input__send-msg-btn",state:c},n))))},t}(s.Component)),w=n("Z2sP"),R=(n("L3x+"),function(e){var t=Object(r.d)("Share","Chat--SharePrompt"),n=Object(r.d)("Close","Chat--SharePrompt"),o=a("chat-share-prompt",{"chat-share-prompt--hidden":e.hide||!e.children});return s.createElement(y.a,{position:E.j.Absolute,fullWidth:!0,className:o},s.createElement(y.a,{fullWidth:!0,padding:{y:.5,left:.5}},s.createElement(y.a,{display:E.d.Flex,padding:1,justifyContent:E.h.Between,alignItems:E.b.Center,flexWrap:E.f.NoWrap},s.createElement(y.a,{"data-a-target":"resub-notification-months-subbed-text","data-test-selector":"share-prompt__text"},e.children),s.createElement(y.a,{display:E.d.Flex,flexWrap:E.f.NoWrap,alignItems:E.b.Center,flexShrink:0,padding:{left:.5}},e.onClickShare?s.createElement(y.a,{display:E.d.Inline,padding:{right:.5},flexShrink:0},s.createElement(N.a,{onClick:e.onClickShare,size:N.b.Small,"data-a-target":"resub-notification-share-notification-btn","data-test-selector":"share-prompt__share-btn"},t)):null,s.createElement(y.a,{flexShrink:0},s.createElement(I.a,{ariaLabel:n,onClick:e.onClickClose,type:I.c.Secondary,icon:D.a.Close,"data-a-target":"resub-notification-close-notification-btn","data-test-selector":"share-prompt__close-btn"}))))),e.progressBarProps?s.createElement(w.a,Object(i.__assign)({},e.progressBarProps)):null)}),L=n("WSq6"),O=n("vHGB"),j=n("ZEQw"),x=n("xZ3y"),U=n("Xuad"),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.__extends)(t,e),t.prototype.render=function(){if(!(this.dataIsReady()&&this.props.data.user&&this.props.data.user.self&&this.props.data.user.self.availableBadges))return null;var e=this.getBitsBadge();return e?s.createElement(y.a,null,s.createElement(O.a,{badge:e}),Object(r.d)("{title} Bits Badge",{title:Object(x.b)(e,this.props.threshold)},"BitsBadgeTierNotification")):(r.k.warn("Didn't render bits badge. Provided threshold is either invalid for the channel or not granted to the current user.",{threshold:this.props.threshold,channelLogin:this.props.channelLogin}),null)},t.prototype.dataIsReady=function(){return this.props.data&&!this.props.data.loading&&!this.props.data.error},t.prototype.getBitsBadge=function(){var e=this;return this.props.data&&this.props.data.user&&this.props.data.user.self&&this.props.data.user.self.availableBadges?this.props.data.user.self.availableBadges.reduce((function(e,t){if(!t)return e;var n=null;switch(t.clickAction){case j.b:n=v.k.GET_BITS;break;case j.d:n=v.k.GET_TURBO;break;case j.c:n=v.k.SUBSCRIBE;break;case j.e:n=v.k.VISIT_URL}return e.push({id:t.id,setID:t.setID,version:t.version,title:t.title,image1x:t.image1x,image2x:t.image2x,image4x:t.image4x,clickAction:n,clickURL:t.clickURL||""}),e}),[]).find((function(t){return t.setID===x.a&&t.version===e.props.threshold.toString()})):null},t}(s.Component),A=Object(p.d)(Object(h.a)(U,{options:function(e){return{variables:{channelLogin:e.channelLogin}}},skip:function(e){return!e.channelLogin||e.threshold<=0}}))(F),M=n("Xa2/"),q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showMessageInput:!1,sendingMessage:!1,hasTrackedImpression:!1},t.autoDismiss=function(){t.trackAction(k.b.AutoSkip),t.dismiss()},t.dataIsReady=function(e){return e.data&&!e.data.loading&&!e.data.error},t.manageParentSpace=function(){t.dataIsReady(t.props)&&t.props.data.user&&t.props.data.user.self&&t.props.data.user.self.bitsBadge&&t.props.data.user.self.bitsBadge.tierNotification?t.props.requestSpace():t.props.dismissSpace()},t.toggleContentShown=function(){t.setState((function(e){return{showMessageInput:!e.showMessageInput}}))},t.share=function(e){return Object(i.__awaiter)(t,void 0,void 0,(function(){var t;return Object(i.__generator)(this,(function(n){switch(n.label){case 0:if(this.state.sendingMessage||!this.props.data.user||!this.props.data.user.self||!this.props.data.user.self.bitsBadge||!this.props.data.user.self.bitsBadge.tierNotification)return[2];this.setSendingState(),n.label=1;case 1:return n.trys.push([1,4,5,6]),this.props.authToken?[4,this.props.updateBitsBadgeTierNotification(Object(g.a)({notificationID:this.props.data.user.self.bitsBadge.tierNotification.id,notificationState:v.m.SHARED,message:e}))]:[3,3];case 2:n.sent(),this.optimisticallyClearNotification(),n.label=3;case 3:return[3,6];case 4:return t=n.sent(),Object(S.d)()?r.k.warn("Failed to post bits badge tier message"):r.k.errorAndReport(t,"Failed to post bits badge tier message"),[3,6];case 5:return this.resetState(),[7];case 6:return[2]}}))}))},t.dismiss=function(){return Object(i.__awaiter)(t,void 0,void 0,(function(){var e;return Object(i.__generator)(this,(function(t){switch(t.label){case 0:if(this.state.sendingMessage||!this.props.data.user||!this.props.data.user.self||!this.props.data.user.self.bitsBadge||!this.props.data.user.self.bitsBadge.tierNotification)return[2];this.setSendingState(),t.label=1;case 1:return t.trys.push([1,4,5,6]),this.props.authToken?[4,this.props.updateBitsBadgeTierNotification(Object(g.a)({notificationID:this.props.data.user.self.bitsBadge.tierNotification.id,notificationState:v.m.SKIPPED}))]:[3,3];case 2:t.sent(),this.optimisticallyClearNotification(),t.label=3;case 3:return[3,6];case 4:return e=t.sent(),Object(S.d)()?r.k.warn("Failed to post bits badge tier skip"):r.k.errorAndReport(e,"Failed to post bits badge tier skip"),[3,6];case 5:return this.resetState(),[7];case 6:return[2]}}))}))},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){this.manageParentSpace()},t.prototype.componentDidUpdate=function(){this.manageParentSpace(),this.props.isSpaceHidden||this.state.hasTrackedImpression||(this.trackAction(k.b.Impression),this.setState({hasTrackedImpression:!0}))},t.prototype.render=function(){if(!(this.dataIsReady(this.props)&&this.props.data.user&&this.props.data.user.self&&this.props.data.user.self.bitsBadge&&this.props.data.user.self.bitsBadge.tierNotification))return null;var e=this.props.data.user.self.bitsBadge.tierNotification;return s.createElement(y.a,{padding:0,attachTop:!0,attachLeft:!0,attachRight:!0,position:E.j.Absolute},s.createElement(R,{hide:this.state.showMessageInput,onClickShare:e.canShare?this.toggleContentShown:void 0,onClickClose:this.dismiss,progressBarProps:{animationDirection:w.b.Down,size:w.c.Small,animationDuration:60,onAnimationEnd:this.autoDismiss,paused:this.props.isSpaceHidden||this.state.showMessageInput}},s.createElement(y.a,null,Object(r.d)("You just earned a new badge!","BitsBadgeTierNotification")),s.createElement(A,{channelLogin:this.props.channelLogin,threshold:e.threshold})),s.createElement(_,{hide:!this.state.showMessageInput,onShare:this.share,onClose:this.toggleContentShown},s.createElement(y.a,{textAlign:E.l.Center},s.createElement(y.a,null,Object(r.d)("Show off your new badge in chat!","BitsBadgeTierNotification")),s.createElement(A,{channelLogin:this.props.channelLogin,threshold:e.threshold}))))},t.prototype.trackAction=function(e){if(!(this.dataIsReady(this.props)&&this.props.data.user&&this.props.data.user.self&&this.props.data.user.self.bitsBadge&&this.props.data.user.self.bitsBadge.tierNotification))return null;Object(k.m)({action:e,userId:this.props.currentUserId||"",userLogin:this.props.currentUserLogin||"",channelId:this.props.channelID||"",channelLogin:this.props.channelLogin,transactionId:this.props.data.user.self.bitsBadge.tierNotification.id,badgeAmount:this.props.data.user.self.bitsBadge.tierNotification.threshold})},t.prototype.optimisticallyClearNotification=function(){Object(g.i)(L,{channelLogin:this.props.channelLogin},(function(e){return e.user&&e.user.self&&e.user.self.bitsBadge&&(e=l(e,(function(e){return e.user.self.bitsBadge.tierNotification}),(function(){return null}))),e}))},t.prototype.setSendingState=function(){this.setState({sendingMessage:!0})},t.prototype.resetState=function(){this.setState({hasTrackedImpression:!1,sendingMessage:!1,showMessageInput:!1})},t}(s.Component),P=Object(p.d)(Object(h.a)(L,{options:function(e){return{variables:{channelLogin:e.channelLogin}}},skip:function(e){return!e.channelLogin}}),Object(f.a)((function(e){return{query:L,variables:{channelLogin:e.channelLogin},topic:e.currentUserId?Object(b.R)(e.currentUserId):"",type:m.PubsubMessageType.UserBitsBadgeNotification,skip:!e.currentUserId,mutator:function(t,n){return n.user&&n.user.self&&n.user.self.bitsBadge&&t.data&&t.data.user_id===e.currentUserId&&t.data.channel_id===e.channelID&&e.data.refetch(),n}}})))(q),V=Object(p.d)(Object(h.a)(M,{name:"updateBitsBadgeTierNotification"}))(P);var W=Object(d.b)((function(e){var t=Object(u.e)(e);return{currentUserId:t?t.id:null,currentUserLogin:t?t.login:null}}))(V),z=n("x7UT"),Q=n("f00E"),$=n("amaQ"),G=n("OFf5"),X=n("cpJf"),H=n("+80q"),J=n("kqSx"),Y=n("EnXQ"),Z=n("3WWB"),K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={resubDismissed:!1,shouldShareStreak:!1,showMessageInput:!1,sendingMessage:!1},t.randomEmoteId=t.getRandomEmoteId(),t.privateCalloutSID=Object(Q.c)(),t.impressionTracked=!1,t.dataIsReady=function(e){return e.data&&!e.data.loading&&!e.data.error},t.resubExists=function(e,t){return e.data.user&&e.data.user.self&&e.data.user.self.resubNotification&&!t.resubDismissed},t.manageParentSpace=function(){if(t.dataIsReady(t.props)&&t.resubExists(t.props,t.state)){if(void 0===t.state.inResubCalloutExperiment){var e="variant2"===r.p.experiments.getAndTrackAssignment(c.c.ChatPrivateCalloutRedesign);if(t.setState({inResubCalloutExperiment:e}),e)return}else if(t.state.inResubCalloutExperiment)return;t.impressionTracked||(t.impressionTracked=!0,Object($.g)({userID:t.props.currentUserID,userLogin:t.props.currentUserLogin,channelID:t.props.data.user.id,channelLogin:t.props.channelLogin,calloutType:$.d.Resub,privateCalloutSID:t.privateCalloutSID,hasCTA:!0})),t.props.requestSpace()}else t.props.dismissSpace()},t.toggleShareStreakCheckbox=function(){t.setState((function(e){return{shouldShareStreak:!e.shouldShareStreak}}))},t.toggleContentShown=function(){t.state.showMessageInput||Object($.f)({userID:t.props.currentUserID,userLogin:t.props.currentUserLogin,channelID:t.props.data.user.id,channelLogin:t.props.channelLogin,calloutType:$.d.Resub,privateCalloutSID:t.privateCalloutSID,clickType:$.b.Share,uiContext:$.c.PrivateCallout}),t.setState((function(e){return{showMessageInput:!e.showMessageInput}}))},t.dismissResubNotification=function(){t.setState({resubDismissed:!0}),Object($.e)({userID:t.props.currentUserID,userLogin:t.props.currentUserLogin,channelID:t.props.data.user.id,channelLogin:t.props.channelLogin,calloutType:$.d.Resub,privateCalloutSID:t.privateCalloutSID,action:$.a.Dismiss,uiContext:$.c.PrivateCallout})},t.shareResub=function(e){return Object(i.__awaiter)(t,void 0,void 0,(function(){var t,n,a,s;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:if(this.state.sendingMessage||!this.props.data.user||!this.props.data.user.self||!this.props.data.user.self.resubNotification)return[2];this.setState({sendingMessage:!0}),Object($.e)({userID:this.props.currentUserID,userLogin:this.props.currentUserLogin,channelID:this.props.data.user.id,channelLogin:this.props.channelLogin,calloutType:$.d.Resub,privateCalloutSID:this.privateCalloutSID,action:$.a.Message,uiContext:$.c.PrivateCallout}),i.label=1;case 1:return i.trys.push([1,4,5,6]),this.props.authToken?(t={message:e,channelLogin:this.props.channelLogin,includeStreak:this.state.shouldShareStreak,tokenID:this.props.data.user.self.resubNotification.token},n={useChatNotificationToken:{__typename:"UseChatNotificationTokenPayload",isSuccess:!0}},a=Object(g.b)(t,n),[4,this.props.shareResubToken(a)]):[3,3];case 2:i.sent(),Object(g.i)(Y,{channelLogin:this.props.channelLogin},(function(e){return e.user&&e.user.self?l(e,(function(e){return e.user.self.resubNotification}),(function(){return null})):e})),this.dismissResubNotification(),i.label=3;case 3:return[3,6];case 4:return s=i.sent(),Object(S.d)()?r.k.warn("Failed to post resub message"):r.k.errorAndReport(s,"Failed to post resub message"),[3,6];case 5:return this.setState({sendingMessage:!1}),[7];case 6:return[2]}}))}))},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){this.manageParentSpace()},t.prototype.componentDidUpdate=function(){this.manageParentSpace(),this.dataIsReady(this.props)&&this.props.data.user&&this.props.data.user.self&&this.props.data.user.self.resubNotification&&!this.randomEmoteId&&(this.randomEmoteId=this.getRandomEmoteId()),this.dataIsReady(this.props)&&this.props.pubsub.messages.subscriptionInfo!=this.props.pubsub.messages.subscriptionInfo&&this.props.data.refetch()},t.prototype.render=function(){if(!(this.dataIsReady(this.props)&&this.resubExists(this.props,this.state)&&this.props.data.user&&this.props.data.user.self&&this.props.data.user.self.resubNotification))return null;if(this.state.inResubCalloutExperiment)return null;var e=this.props.data.user.self.resubNotification,t=e.cumulativeTenureMonths;return s.createElement(y.a,{className:"chat-resub-notification",padding:0,attachTop:!0,attachLeft:!0,attachRight:!0,position:E.j.Absolute},s.createElement(R,{hide:this.state.showMessageInput,onClickShare:this.toggleContentShown,onClickClose:this.dismissResubNotification},s.createElement(H.a,null,Object(r.d)("It's your {monthsSubbed, number} month anniversary!",{monthsSubbed:t},"ChatResubNotification"))),s.createElement(_,{hide:!this.state.showMessageInput,onShare:this.shareResub,onClose:this.toggleContentShown},s.createElement(y.a,{textAlign:E.l.Center},s.createElement(G.a,{emoteID:this.randomEmoteId,animate:this.state.showMessageInput}),s.createElement(E.g,{margin:{bottom:1,top:1}},s.createElement(H.a,null,Object(r.d)("Share your Sub anniversary in chat! Let <x:strong>{channelName}</x:strong> know you've been subbed for <x:strong>{monthsSubbed} months</x:strong>.",{channelName:this.props.channelDisplayName||this.props.channelLogin,monthsSubbed:t,"x:strong":function(e){return s.createElement(H.a,{bold:!0,type:H.e.Span},e)}},"ChatResubNotification")))),s.createElement(J.a,{checked:this.state.shouldShareStreak,label:Object(r.d)("Show my {streakMonths, number} month streak in the chat message.",{streakMonths:e.streakTenureMonths},"ChatResubNotification"),onChange:this.toggleShareStreakCheckbox})))},t.prototype.getRandomEmoteId=function(){var e=Math.floor(Math.random()*X.b.length);return X.b[e]},t}(s.Component),ee=Object(p.d)(Object(h.a)(Y,{options:function(e){return{variables:{channelLogin:e.channelLogin}}},skip:function(e){return!e.channelLogin}}),Object(h.a)(Z,{name:"shareResubToken"}),Object(z.a)([{topic:function(e){return Object(b.U)(e.currentUserID?e.currentUserID:"")},mapMessageTypesToProps:{"*":"subscriptionInfo"},skip:function(e){return!e.currentUserID}}]))(K);var te,ne=Object(d.b)((function(e){var t=Object(u.e)(e);return{currentUserLogin:t?t.login:null,currentUserID:t?t.id:null,isStaff:Object(u.g)(e)}}))(ee);n("z5b3");!function(e){e[e.Resub=1]="Resub",e[e.Purchase=2]="Purchase",e[e.BitsBadgeTier=3]="BitsBadgeTier"}(te||(te={}));var ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={requestedSpaces:new Set},t.isAllowedToShareResub="control"===r.p.experiments.getAndTrackAssignment(c.c.ShareResub),t.addSpace=function(e){t.state.requestedSpaces.has(e)||t.setState((function(t){var n=new Set(t.requestedSpaces);return n.add(e),{requestedSpaces:n}}))},t.removeSpace=function(e){t.state.requestedSpaces.has(e)&&t.setState((function(t){var n=new Set(t.requestedSpaces);return n.delete(e),{requestedSpaces:n}}))},t.requestResubSpace=function(){t.addSpace(te.Resub)},t.dismissResubSpace=function(){t.removeSpace(te.Resub)},t.requestBitsBadgeTierSpace=function(){"control"===r.p.experiments.getAndTrackAssignment(c.c.ChatPrivateCalloutRedesign)&&t.addSpace(te.BitsBadgeTier)},t.dismissBitsBadgeTierSpace=function(){t.removeSpace(te.BitsBadgeTier)},t}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=null;this.state.requestedSpaces.size&&(e=Array.from(this.state.requestedSpaces.values()).sort()[0]);var t=e!==te.BitsBadgeTier,n=a({"share-to-chat__space--hidden":e!==te.Resub}),i=a({"share-to-chat__space--hidden":t});return s.createElement(y.a,null,s.createElement(y.a,{className:n},this.isAllowedToShareResub&&s.createElement(ne,{authToken:this.props.authToken,channelDisplayName:this.props.channelDisplayName,channelLogin:this.props.channelLogin,requestSpace:this.requestResubSpace,dismissSpace:this.dismissResubSpace})),s.createElement(o.a,{name:"bits_badge_tier_notification"},s.createElement(y.a,{className:i},s.createElement(W,{authToken:this.props.authToken,channelLogin:this.props.channelLogin,channelID:this.props.channelID,requestSpace:this.requestBitsBadgeTierSpace,dismissSpace:this.dismissBitsBadgeTierSpace,isSpaceHidden:t}))))},t}(s.Component);n.d(t,"PublicProps",(function(){})),n.d(t,"ShareToChat",(function(){return ie}))},tRzL:function(e,t,n){},z5b3:function(e,t,n){}}]);